@model EMAC.ViewModels.AdminDashboardViewModel
@{
    ViewData["Title"] = "لوحة التحكم الرئيسية";
    var serviceNames = ViewBag.ServiceNames as Dictionary<string, string>;
}

<div class="container" style="padding-top: 120px; padding-bottom: 50px;">

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h1>لوحة القيادة (Dashboard)</h1>
        <a href="@Url.Action("Logout", "Admin")" class="btn secondary-btn" style="padding: 10px 20px;">تسجيل خروج</a>
    </div>

    <div style="background-color: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 30px;">
        <h3 style="margin-top: 0; color: var(--primary-color);"><i class="fas fa-cogs"></i> إعدادات النظام</h3>
        <p style="color: #666; margin-bottom: 15px;">التحكم في البيانات الأساسية للموقع والفريق.</p>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <a href="@Url.Action("Services", "Admin")" class="btn primary-btn" style="padding: 10px 20px; font-size: 1em;">
                <i class="fas fa-list"></i> إدارة الخدمات
            </a>
            <a href="@Url.Action("Technicians", "Admin")" class="btn primary-btn" style="padding: 10px 20px; font-size: 1em; background-color: #17a2b8;">
                <i class="fas fa-users-cog"></i> إدارة الفنيين
            </a>
            <a href="@Url.Action("Categories", "Admin")" class="btn primary-btn" style="padding: 10px 20px; font-size: 1em; background-color: #6c757d;">
                <i class="fas fa-tags"></i> إدارة الأقسام
            </a>
            <a href="@Url.Action("Products", "Admin")" class="btn primary-btn" style="padding: 10px 20px; font-size: 1em; background-color: #6c757d;">
                <i class="fas fa-box-open"></i> إدارة المنتجات
            </a>
            <a href="@Url.Action("AdGenerator", "Admin")" class="btn primary-btn" style="padding: 10px 20px; font-size: 1em; background-color: #e83e8c;">
                <i class="fas fa-magic"></i> مولد الإعلانات
            </a>
            <a href="@Url.Action("Requests", "Admin")" class="btn secondary-btn" style="padding: 10px 20px; font-size: 1em;">
                <i class="fas fa-clipboard-list"></i> سجل الطلبات
            </a>
            <a href="@Url.Action("Invoices", "Admin")" class="btn secondary-btn" style="padding: 10px 20px; font-size: 1em;">
                <i class="fas fa-file-invoice-dollar"></i> أرشيف الفواتير
            </a>
        </div>
    </div>

    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px;">
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-right: 4px solid var(--primary-color);">
            <h3 style="margin: 0; font-size: 1em; color: #666;">إجمالي الطلبات</h3>
            <p style="font-size: 2em; font-weight: bold; margin: 10px 0; color: var(--primary-color);">@Model.TotalRequests</p>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-right: 4px solid orange;">
            <h3 style="margin: 0; font-size: 1em; color: #666;">طلبات معلقة</h3>
            <p style="font-size: 2em; font-weight: bold; margin: 10px 0; color: orange;">@Model.PendingRequests</p>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-right: 4px solid var(--secondary-color);">
            <h3 style="margin: 0; font-size: 1em; color: #666;">أجهزة بالورشة</h3>
            <p style="font-size: 2em; font-weight: bold; margin: 10px 0; color: var(--secondary-color);">@Model.ActiveWorkshopTickets</p>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-right: 4px solid green;">
            <h3 style="margin: 0; font-size: 1em; color: #666;">إجمالي الإيرادات</h3>
            <p style="font-size: 2em; font-weight: bold; margin: 10px 0; color: green;">@Model.TotalRevenue.ToString("C")</p>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
            <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">آخر طلبات الصيانة</h3>
            <table style="width: 100%; text-align: right;">
                <thead>
                    <tr style="color: #888;"><th>العميل</th><th>الخدمة</th><th>الحالة</th></tr>
                </thead>
                <tbody>
                    @foreach (var req in Model.RecentRequests)
                    {
                        <tr style="border-bottom: 1px solid #f9f9f9;">
                            <td style="padding: 10px 0;">@req.CustomerName</td>
                            <td>
                                @(serviceNames != null && serviceNames.ContainsKey(req.ServiceType) ? serviceNames[req.ServiceType] : req.ServiceType)
                            </td>
                            <td>
                                <span style="background: #eef; color: var(--primary-color); padding: 2px 8px; border-radius: 4px; font-size: 0.8em;">
                                    @if (req.Status == "Pending")
                                    {
                                        <text>معلق</text>
                                    }
                                    else if (req.Status == "Confirmed")
                                    {

                                        <text>مؤكد</text>
                                    }
                                    else if (req.Status == "InProcess")
                                    {

                                        <text>قيد التنفيذ</text>
                                    }
                                    else if (req.Status == "InWorkshop")
                                    {

                                        <text>في الورشة</text>
                                    }
                                    else if (req.Status == "PaymentPending")
                                    {

                                        <text>بانتظار الدفع</text>
                                    }
                                    else if (req.Status == "Completed")
                                    {

                                        <text>مكتمل</text>
                                    }
                                    else if (req.Status == "Closed")
                                    {

                                        <text>مغلق</text>
                                    }
                                    else if (req.Status == "Rejected")
                                    {

                                        <text>مرفوض</text>
                                    }
                                    else
                                    {

                                        <text>@req.Status</text>
                                    }
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
            <h3 style="border-bottom: 2px solid #eee; padding-bottom: 10px;">آخر الفواتير الصادرة</h3>
            <table style="width: 100%; text-align: right;">
                <thead>
                    <tr style="color: #888;"><th>رقم الجهاز</th><th>المبلغ</th><th>إجراء</th></tr>
                </thead>
                <tbody>
                    @foreach (var inv in Model.RecentInvoices)
                    {
                        <tr style="border-bottom: 1px solid #f9f9f9;">
                            <td style="padding: 10px 0;">@(inv.WorkshopTicket?.DeviceCode ?? "N/A")</td>
                            <td style="font-weight: bold; color: green;">@inv.TotalAmount.ToString("N2")</td>
                            <td><a href="@Url.Action("InvoicePrint", "Admin", new { id = inv.Id })" target="_blank"><i class="fas fa-print"></i></a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>